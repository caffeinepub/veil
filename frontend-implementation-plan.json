{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Fix RTS blob_of_principal invalid principal crash - Frontend Guards",
  "requirements": [
    {
      "id": "REQ-129",
      "summary": "Reinforce anonymous identity guards in useQueries.ts to prevent any backend actor calls when the caller is unauthenticated or using the anonymous identity",
      "acceptanceCriteria": [
        "No backend actor call is ever dispatched when isAuthenticated is false or the identity is the anonymous identity.",
        "All useQuery hooks skip (enabled: false) when the caller is unauthenticated or anonymous.",
        "All useMutation hooks return early without calling the actor when the caller is anonymous.",
        "After a successful Internet Identity login, all queries resume normally and backend calls succeed."
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Add a helper function at the top of the file that checks both isAuthenticated from useInternetIdentity and verifies the identity is not the anonymous identity. Update all useQuery hooks to include this check in their enabled condition (combining it with existing actor checks using &&). Update all useMutation hooks (useRegister, useCreatePost, useEditPost, useDeletePost, useSetPostPrivacy, useAddReaction, useSaveCallerUserProfile, useGenerateInviteCode, useAddInviteCode, useRevokeInviteCode, useAdminDeletePost, useAdminSuspendUser, useAdminUnsuspendUser, useSetSubscriptionStatus, useAssignCallerUserRole) to call this helper at the start of their mutationFn and return early (without invoking the actor) if the check fails. Ensure the helper returns false when identity is null, undefined, or matches the anonymous principal pattern."
        }
      ]
    }
  ]
}