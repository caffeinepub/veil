{
  "schemaVersion": "1.0.0",
  "projectStateVersion": 3,
  "summary": "App with user authentication and account creation flow. Fixing signup flow to ensure valid principal exists before account creation.",
  "architectural_notes": [
    "Account creation must only occur after a valid, non-anonymous principal is obtained from authentication",
    "Guard condition required: validate principal before calling backend createUser() or converting to blob"
  ],
  "known_issues": [
    "RTS error: blob_of_principal: invalid principal â€” triggered when Create Account button is clicked before authentication completes"
  ],
  "isFixRequest": true,
  "existing_features": [
    {
      "id": "feature-in-signuppage-tsx-before-calling-the-backend-createuser-function-add-a-guard-that-checks-whether-the-authenticated-identity-principal-is-available-and-is-not-anonymous-if-the-principal-is-missing-or-anonymous-display-an-error-message-authentication-required-please-log-in-before-creating-an-account-and-abort-the-account-creation-flow-entirely",
      "title": "In SignupPage.tsx, before calling the backend createUser() function, add a guard that checks whether the authenticated identity/principal is available and is not anonymous. If the principal is missing or anonymous, display an error message ('Authentication required. Please log in before creating an account.') and abort the account creation flow entirely.",
      "reqIds": [
        "REQ-1"
      ],
      "version": 1
    },
    {
      "id": "feature-in-signuppage-tsx-ensure-the-create-account-button-is-disabled-and-visually-reflects-this-when-the-authenticated-identity-has-not-yet-fully-initialized-or-when-the-principal-is-anonymous-the-button-should-only-become-enabled-once-a-valid-non-anonymous-principal-is-confirmed-to-be-available",
      "title": "In SignupPage.tsx, ensure the Create Account button is disabled (and visually reflects this) when the authenticated identity has not yet fully initialized or when the principal is anonymous. The button should only become enabled once a valid non-anonymous principal is confirmed to be available.",
      "reqIds": [
        "REQ-2"
      ],
      "version": 1
    }
  ],
  "new_feature_requests": [
    {
      "id": "AR-3",
      "summary": "In the backend main.mo createUser() function, add a guard at the entry point to validate that caller is not the anonymous principal (Principal.isAnonymous(caller)). If caller is anonymous, return an error variant instead of attempting to convert the principal to blob or create the user record.",
      "reqIds": [
        "REQ-3"
      ],
      "status": "pending"
    }
  ],
  "gameProjectType": "none",
  "projectName": "Fix signup flow to guard against invalid/anonymous principal before account creation",
  "clarification_mode": "instant",
  "clarification_rounds": 0
}